<!DOCTYPE html>
<html>
<head>
	<title>{{ title }}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/static/jquery.mobile-1.1.0.min.css" />
	<script src="/static/jquery-1.7.2.min.js"></script>
	<script src="/static/jquery.mobile-1.1.0.min.js"></script>
	<script>

function send_cmd(cmd) {
	var data = "/" + cmd.replace(/ /g, "/");
	var req = new XMLHttpRequest();
	req.open("POST", encodeURIComponent(data), true);
	req.send();
};

function parse_avr_state(e) {
	var s = JSON.parse(e.data) // extract AVR state info
	var state_str = "Unknown"
	if (s) {
		state_str  = $.trim(s.line1) + "\n";
		state_str += $.trim(s.line2) + "\n";
		if (s.volume != null) {
			state_str += s.volume + "dB\n";
		}
		state_str += s.source + "/" +
			s.channels_string + "\n";
		state_str += s.surround_string + "\n";
		state_str += s.speakers_string;
	}
	$('#avr_state').contents().replaceWith(state_str);
};

var source = new EventSource('/events');
source.onmessage = parse_avr_state;

	</script>

</head>
<body>

<div data-role="page" id="main" style="text-align: center">

<div data-role="header">
	<h1>A/V Control</h1>
</div><!-- /header -->

<div data-role="content">
	{% if "avr on" in cmd_handlers %}
	<h3>Surround Receiver</h3>
	<div data-role="controlgroup" data-type="horizontal">
		<button onclick="send_cmd('avr on')" data-theme="a">On</button>
		<button onclick="send_cmd('avr off')" data-theme="a">Off</button>
	</div>
	<div data-role="controlgroup" data-type="horizontal">
		<button onclick="send_cmd('avr vol-')">Vol-</button>
		<button onclick="send_cmd('avr mute')" data-theme="b">Mute</button>
		<button onclick="send_cmd('avr vol+')">Vol+</button>
	</div>
	<div data-role="controlgroup" data-type="horizontal">
		<!-- <button onclick="send_cmd('avr surround 6ch')">5.1</button> -->
		<button onclick="send_cmd('avr surround dolby')">Surround<!-- Dolby --></button>
		<!-- <button onclick="send_cmd('avr surround dts')">DTS</button> -->
		<button onclick="send_cmd('avr surround stereo')">Stereo</button>
	</div>
	{% end %}

	{% if "hdmi on" in cmd_handlers %}
	<h3>HDMI Switch</h3>
	<div data-role="controlgroup" data-type="horizontal">
		<button onclick="send_cmd('hdmi on')" data-theme="a">On/Off</button>
		<button onclick="send_cmd('hdmi 1')">HTPC</button>
		<button onclick="send_cmd('hdmi 2')">Get</button>
		<button onclick="send_cmd('hdmi 3')">PS3</button>
		<!-- <button onclick="send_cmd('hdmi 4')">Wii</button> -->
	</div>
	{% end %}
</div><!-- /content -->

<div data-role="footer">
	<pre id="avr_state">Initializing...</pre>
</div><!-- /footer -->

</div><!-- /page -->

</body>
</html>
